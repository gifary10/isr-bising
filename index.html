<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pengecekan Kebisingan Area Kerja</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Roboto Font -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- SheetJS untuk ekspor Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8f9fa;
            padding-top: 20px;
        }
        .container {
            max-width: 1200px;
        }
        .card {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .table-responsive {
            max-height: 500px;
        }
        .btn-action {
            margin-right: 5px;
        }
        .form-label {
            font-weight: 500;
        }
        .header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #6c757d;
        }
        .alert-custom {
            border-left: 5px solid #0d6efd;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header text-center">
            <h1 class="display-5 fw-bold">Pengecekan Kebisingan Area Kerja</h1>
        </div>

        <!-- Form Input Data -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">Input Data Pengukuran Kebisingan</h5>
            </div>
            <div class="card-body">
                <form id="measurementForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="tanggal" class="form-label">Tanggal Pengukuran</label>
                            <input type="date" class="form-control" id="tanggal" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="lokasi" class="form-label">Lokasi</label>
                            <input type="text" class="form-control" id="lokasi" placeholder="Masukkan lokasi pengukuran" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="sumberBising" class="form-label">Sumber Kebisingan</label>
                            <input type="text" class="form-control" id="sumberBising" placeholder="Masukkan sumber kebisingan" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="hasilPengukuran" class="form-label">Hasil Pengukuran (dB)</label>
                            <input type="number" class="form-control" id="hasilPengukuran" placeholder="Masukkan hasil dalam dB" min="0" step="0.1" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="keterangan" class="form-label">Keterangan (Opsional)</label>
                        <textarea class="form-control" id="keterangan" rows="2" placeholder="Tambahkan keterangan jika diperlukan"></textarea>
                    </div>
                    <button type="submit" class="btn btn-success">Simpan Data</button>
                    <button type="reset" class="btn btn-secondary">Reset Form</button>
                </form>
            </div>
        </div>

        <!-- Tabel Data -->
        <div class="card">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">Data Pengukuran Kebisingan</h5>
                <button id="exportBtn" class="btn btn-light btn-sm">Ekspor ke Excel</button>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Tanggal</th>
                                <th>Lokasi</th>
                                <th>Sumber Bising</th>
                                <th>Hasil Pengukuran (dB)</th>
                                <th>Keterangan</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="dataTable">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div id="emptyMessage" class="alert alert-info text-center" style="display: none;">
                    Belum ada data pengukuran. Silakan tambahkan data melalui form di atas.
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>&copy; 2025 Aplikasi Pengecekan Kebisingan Area Kerja</p>
        </div>
    </div>

    <!-- Modal untuk Edit Data -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Edit Data Pengukuran</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <input type="hidden" id="editId">
                        <div class="mb-3">
                            <label for="editTanggal" class="form-label">Tanggal Pengukuran</label>
                            <input type="date" class="form-control" id="editTanggal" required>
                        </div>
                        <div class="mb-3">
                            <label for="editLokasi" class="form-label">Lokasi</label>
                            <input type="text" class="form-control" id="editLokasi" required>
                        </div>
                        <div class="mb-3">
                            <label for="editSumberBising" class="form-label">Sumber Kebisingan</label>
                            <input type="text" class="form-control" id="editSumberBising" required>
                        </div>
                        <div class="mb-3">
                            <label for="editHasilPengukuran" class="form-label">Hasil Pengukuran (dB)</label>
                            <input type="number" class="form-control" id="editHasilPengukuran" min="0" step="0.1" required>
                        </div>
                        <div class="mb-3">
                            <label for="editKeterangan" class="form-label">Keterangan</label>
                            <textarea class="form-control" id="editKeterangan" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="updateBtn">Perbarui Data</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Inisialisasi data dari localStorage
        let noiseData = JSON.parse(localStorage.getItem('noiseData')) || [];
        
        // DOM Elements
        const measurementForm = document.getElementById('measurementForm');
        const dataTable = document.getElementById('dataTable');
        const emptyMessage = document.getElementById('emptyMessage');
        const exportBtn = document.getElementById('exportBtn');
        const editModal = new bootstrap.Modal(document.getElementById('editModal'));
        const editForm = document.getElementById('editForm');
        const updateBtn = document.getElementById('updateBtn');
        
        // Format tanggal untuk tampilan
        function formatDate(dateString) {
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            return new Date(dateString).toLocaleDateString('id-ID', options);
        }
        
        // Render tabel data
        function renderTable() {
            if (noiseData.length === 0) {
                dataTable.innerHTML = '';
                emptyMessage.style.display = 'block';
                return;
            }
            
            emptyMessage.style.display = 'none';
            
            dataTable.innerHTML = noiseData.map((item, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${formatDate(item.tanggal)}</td>
                    <td>${item.lokasi}</td>
                    <td>${item.sumberBising}</td>
                    <td>${item.hasilPengukuran}</td>
                    <td>${item.keterangan || '-'}</td>
                    <td>
                        <button class="btn btn-warning btn-sm btn-action" onclick="editData(${index})">Edit</button>
                        <button class="btn btn-danger btn-sm btn-action" onclick="deleteData(${index})">Hapus</button>
                    </td>
                </tr>
            `).join('');
        }
        
        // Simpan data baru
        measurementForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newData = {
                id: Date.now(),
                tanggal: document.getElementById('tanggal').value,
                lokasi: document.getElementById('lokasi').value,
                sumberBising: document.getElementById('sumberBising').value,
                hasilPengukuran: parseFloat(document.getElementById('hasilPengukuran').value),
                keterangan: document.getElementById('keterangan').value
            };
            
            noiseData.push(newData);
            localStorage.setItem('noiseData', JSON.stringify(noiseData));
            renderTable();
            
            // Reset form
            measurementForm.reset();
            
            // Tampilkan notifikasi
            showAlert('Data berhasil disimpan!', 'success');
        });
        
        // Edit data
        function editData(index) {
            const item = noiseData[index];
            
            document.getElementById('editId').value = index;
            document.getElementById('editTanggal').value = item.tanggal;
            document.getElementById('editLokasi').value = item.lokasi;
            document.getElementById('editSumberBising').value = item.sumberBising;
            document.getElementById('editHasilPengukuran').value = item.hasilPengukuran;
            document.getElementById('editKeterangan').value = item.keterangan || '';
            
            editModal.show();
        }
        
        // Update data
        updateBtn.addEventListener('click', function() {
            const index = document.getElementById('editId').value;
            
            noiseData[index] = {
                id: noiseData[index].id,
                tanggal: document.getElementById('editTanggal').value,
                lokasi: document.getElementById('editLokasi').value,
                sumberBising: document.getElementById('editSumberBising').value,
                hasilPengukuran: parseFloat(document.getElementById('editHasilPengukuran').value),
                keterangan: document.getElementById('editKeterangan').value
            };
            
            localStorage.setItem('noiseData', JSON.stringify(noiseData));
            renderTable();
            editModal.hide();
            
            showAlert('Data berhasil diperbarui!', 'success');
        });
        
        // Hapus data
        function deleteData(index) {
            if (confirm('Apakah Anda yakin ingin menghapus data ini?')) {
                noiseData.splice(index, 1);
                localStorage.setItem('noiseData', JSON.stringify(noiseData));
                renderTable();
                
                showAlert('Data berhasil dihapus!', 'warning');
            }
        }
        
        // Ekspor ke Excel
        exportBtn.addEventListener('click', function() {
            if (noiseData.length === 0) {
                showAlert('Tidak ada data untuk diekspor!', 'warning');
                return;
            }
            
            // Format data untuk ekspor
            const exportData = noiseData.map(item => ({
                'Tanggal': formatDate(item.tanggal),
                'Lokasi': item.lokasi,
                'Sumber Bising': item.sumberBising,
                'Hasil Pengukuran (dB)': item.hasilPengukuran,
                'Keterangan': item.keterangan || '-'
            }));
            
            // Buat worksheet
            const ws = XLSX.utils.json_to_sheet(exportData);
            
            // Buat workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Data Kebisingan');
            
            // Ekspor ke file Excel
            const fileName = `data_kebisingan_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showAlert('Data berhasil diekspor ke Excel!', 'success');
        });
        
        // Tampilkan alert
        function showAlert(message, type) {
            // Hapus alert sebelumnya jika ada
            const existingAlert = document.querySelector('.alert-custom');
            if (existingAlert) {
                existingAlert.remove();
            }
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show alert-custom`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            
            document.querySelector('.container').insertBefore(alertDiv, document.querySelector('.header').nextSibling);
            
            // Auto-hide alert setelah 3 detik
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 3000);
        }
        
        // Inisialisasi tanggal dengan hari ini
        document.getElementById('tanggal').valueAsDate = new Date();
        
        // Render tabel saat pertama kali dimuat
        renderTable();
    </script>
</body>
</html>
